<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cuenta regresiva con segundos y sonido</title>
  <style>
    :root {
      --bg: #0f172a;
      --text: #e6eef6;
      --muted: #94a3b8;
      --card: rgba(255,255,255,0.03);
      --accent: #06b6d4;
    }

    body.light {
      --bg: #f2f5f8;
      --text: #0f172a;
      --muted: #475569;
      --card: #ffffff;
      --accent: #06b6d4;
    }

    body {
      font-family: Inter, system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      transition: background 0.3s, color 0.3s;
      font-size: 1.05rem;
    }

    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 24px;
      width: 100%;
      max-width: 720px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      transition: background 0.3s, color 0.3s;
      position: relative;
    }

    h1 {
      margin: 0 0 16px 0;
      font-size: 1.4rem;
      text-align: center;
    }

    .row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 16px;
      justify-content: center;
    }

    label {
      font-size: 0.9rem;
      color: var(--muted);
    }

    input[type=datetime-local], select, input[type=file] {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.1);
      padding: 10px 12px;
      color: inherit;
      border-radius: 8px;
      min-width: 230px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }

    body.light input[type=datetime-local],
    body.light select,
    body.light input[type=file] {
      border-color: #cbd5e1;
    }

    button {
      background: var(--accent);
      color: #042;
      border: none;
      padding: 10px 16px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      transition: background 0.3s, color 0.3s, transform 0.1s;
    }

    button:hover {
      transform: scale(1.03);
    }

    button.ghost {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.1);
      color: var(--muted);
    }

    body.light button.ghost {
      border-color: #cbd5e1;
    }

    #themeToggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: transparent;
      border: 1px solid rgba(255,255,255,0.15);
      color: var(--text);
      font-size: 1rem;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }

    body.light #themeToggle {
      border-color: #cbd5e1;
    }

    .bar-wrap {
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.2);
      border-radius: 16px;
      height: 40px;
      width: 100%;
      overflow: hidden;
      margin-top: 16px;
      position: relative;
    }

    body.light .bar-wrap {
      border-color: #cbd5e1;
    }

    .bar {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 0%;
      transition: width 0.25s linear, background-color 0.25s linear;
    }

    .bar-text {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      font-weight: 700;
      font-size: 1.2rem;
      pointer-events: none;
      text-shadow: 0 0 8px rgba(0,0,0,0.5);
    }

    body.light .bar-text {
      color: #111;
      text-shadow: none;
    }

    .info {
      display: flex;
      justify-content: space-between;
      margin-top: 12px;
      font-size: 1rem;
      color: var(--muted);
      flex-wrap: wrap;
      gap: 8px;
    }

    .big {
      font-size: 1.2rem;
      color: var(--text);
      font-weight: 700;
    }

    @media(max-width:520px){
      input[type=datetime-local] {
        min-width: 160px;
      }
    }
  </style>
</head>
<body>
  <button id="themeToggle">üåô Modo claro</button>

  <div class="card">
    <h1>Cuenta regresiva con segundos</h1>

    <div class="row">
      <div>
        <label>Inicio</label><br/>
        <input id="start" type="datetime-local" step="1" />
      </div>
      <div>
        <label>Fin</label><br/>
        <input id="end" type="datetime-local" step="1" />
      </div>
      <div style="display:flex;align-items:end;gap:8px;">
        <button id="apply">Aplicar</button>
        <button id="setNowStart" class="ghost">Iniciar ahora</button>
        <button id="setDefault" class="ghost">Ejemplo +1h</button>
      </div>
    </div>

    <div class="row">
      <div>
        <label>Sonido al finalizar</label><br/>
        <select id="soundSelect">
          <option value="ding">Ding</option>
          <option value="bell">Campana</option>
          <option value="alarm">Alarma</option>
          <option value="custom">Subir sonido propio...</option>
        </select>
      </div>
      <div id="customSoundDiv" style="display:none;">
        <label>Archivo de sonido (.mp3/.wav)</label><br/>
        <input type="file" id="customSoundInput" accept="audio/*">
      </div>
    </div>

    <div class="info">
      <div>
        <div>Estado</div>
        <div id="status" class="big">‚Äî</div>
      </div>
      <div style="text-align:right;">
        <div>Tiempo restante</div>
        <div id="remaining" class="big">‚Äî</div>
      </div>
    </div>

    <div class="bar-wrap">
      <div id="bar" class="bar"></div>
      <div id="barText" class="bar-text">0%</div>
    </div>

    <div class="info">
      <div>Inicio: <span id="showStart">‚Äî</span></div>
      <div>Fin: <span id="showEnd">‚Äî</span></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <script>
    const startInput = document.getElementById('start');
    const endInput = document.getElementById('end');
    const applyBtn = document.getElementById('apply');
    const setNowStartBtn = document.getElementById('setNowStart');
    const setDefaultBtn = document.getElementById('setDefault');
    const statusEl = document.getElementById('status');
    const remainingEl = document.getElementById('remaining');
    const bar = document.getElementById('bar');
    const barText = document.getElementById('barText');
    const showStart = document.getElementById('showStart');
    const showEnd = document.getElementById('showEnd');
    const themeToggle = document.getElementById('themeToggle');
    const soundSelect = document.getElementById('soundSelect');
    const customSoundDiv = document.getElementById('customSoundDiv');
    const customSoundInput = document.getElementById('customSoundInput');

    let startTime = null, endTime = null, timer = null, finished = false;
    let customSound = null;

    const sounds = {
      ding: "https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg",
      bell: "https://actions.google.com/sounds/v1/alarms/medium_bell_ringing_near.ogg",
      alarm: "https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"
    };

    soundSelect.onchange = () => {
      customSoundDiv.style.display = soundSelect.value === "custom" ? "block" : "none";
    };

    customSoundInput.onchange = (e) => {
      const file = e.target.files[0];
      if (file) {
        customSound = URL.createObjectURL(file);
      }
    };

    themeToggle.onclick = () => {
      document.body.classList.toggle('light');
      themeToggle.textContent = document.body.classList.contains('light')
        ? 'üåô Modo oscuro'
        : '‚òÄÔ∏è Modo claro';
    };

    function parseDT(v){ if(!v) return null; const d=new Date(v); return isNaN(d)?null:d; }
    function fmt(d){ return d?d.toLocaleString():'‚Äî'; }
    function fmtRemain(ms){
      if(ms<=0) return '0s';
      const s=Math.floor(ms/1000);
      const h=Math.floor(s/3600);
      const m=Math.floor((s%3600)/60);
      const sec=s%60;
      return `${h}h ${m}m ${sec}s`;
    }
    function clamp(v,a,b){return Math.max(a,Math.min(b,v));}
    function getColor(percent){ const hue = percent * 1.2; return `hsl(${hue}, 90%, 45%)`; }

    function playSound(){
      const selected = soundSelect.value;
      let src = selected === "custom" && customSound ? customSound : sounds[selected];
      if (src) new Audio(src).play();
    }

    function showConfetti(){
      const duration = 3000;
      const end = Date.now() + duration;
      (function frame(){
        confetti({
          particleCount: 5,
          spread: 70,
          origin: { y: 0.6 }
        });
        if(Date.now() < end) requestAnimationFrame(frame);
      })();
    }

    function updateUI(){
      const now = new Date();
      showStart.textContent = fmt(startTime);
      showEnd.textContent = fmt(endTime);

      if(!startTime || !endTime){
        statusEl.textContent = 'Define inicio y fin';
        return;
      }

      if(endTime <= startTime){
        statusEl.textContent = 'Hora fin > inicio';
        return;
      }

      if(now < startTime){
        statusEl.textContent = 'A√∫n no inicia';
        remainingEl.textContent = 'Empieza en ' + fmtRemain(startTime - now);
        bar.style.width = '0%';
        bar.style.backgroundColor = getColor(0);
        barText.textContent = '0%';
        finished = false;
        return;
      }

      if(now >= endTime){
        statusEl.textContent = 'Completado';
        remainingEl.textContent = '0s';
        bar.style.width = '100%';
        bar.style.backgroundColor = getColor(100);
        barText.textContent = '100%';
        if(!finished){
          playSound();
          showConfetti();
          finished = true;
        }
        return;
      }

      // En curso
      statusEl.textContent = 'En curso';
      const total = endTime - startTime;
      const elapsed = now - startTime;
      const remaining = endTime - now;
      const pct = clamp((elapsed / total) * 100, 0, 100);
      const color = getColor(pct);
      bar.style.width = pct + '%';
      bar.style.backgroundColor = color;
      barText.textContent = pct.toFixed(1) + '%';
      remainingEl.textContent = fmtRemain(remaining);
      finished = false;
    }

    function startTimer(){
      if(timer) clearInterval(timer);
      updateUI();
      timer = setInterval(updateUI, 300);
    }

    function toInputVal(d){
      const p=n=>String(n).padStart(2,'0');
      return `${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())}T${p(d.getHours())}:${p(d.getMinutes())}:${p(d.getSeconds())}`;
    }

    applyBtn.onclick = () => {
      startTime = parseDT(startInput.value);
      endTime = parseDT(endInput.value);
      startTimer();
    };

    setNowStartBtn.onclick = () => {
      const now = new Date();
      startInput.value = toInputVal(now);
      if(!endInput.value){
        const later = new Date(now.getTime() + 60*60*1000);
        endInput.value = toInputVal(later);
      }
      applyBtn.click();
    };

    setDefaultBtn.onclick = () => {
      const now = new Date();
      const later = new Date(now.getTime() + 60*60*1000);
      startInput.value = toInputVal(now);
      endInput.value = toInputVal(later);
      applyBtn.click();
    };

    // Inicializar
    setDefaultBtn.click();
  </script>
</body>
</html>
